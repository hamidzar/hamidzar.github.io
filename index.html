<!DOCTYPE html>
<html>
<head>
  <title>Tree Data Processor</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <h2>Enter Height and DBH</h2>

  <label for="heightInput">Height:</label>
  <input type="number" id="heightInput" step="0.01" value="0" />

  <label for="dbhInput">DBH:</label>
  <input type="number" id="dbhInput" step="0.01" value="0" />

  <button onclick="loadCSV()">Load Data</button>

  <br><br>
  <select id="dropdown"></select>
  <p id="result"></p>

  <script>
    function loadCSV() {
      const height = parseFloat(document.getElementById("heightInput").value) || 0;
      const dbh = parseFloat(document.getElementById("dbhInput").value) || 0;

     const aCsvUrl = "https://raw.githubusercontent.com/hamidzar/hamidzar.github.io/main/biomass/AGBnoHeight.csv"; // Replace with your actual CSV URL
     const bCsvUrl = "https://raw.githubusercontent.com/hamidzar/hamidzar.github.io/main/biomass/AGBwithheights.csv";
      const csvUrl = height === 0 ? aCsvUrl : bCsvUrl;

      d3.csv(csvUrl).then(data => {
        const dropdown = document.getElementById("dropdown");
        dropdown.innerHTML = "";

        data.forEach(row => {
          const estimate = parseFloat(row.estimatebwood1);
          const option = document.createElement("option");

           if (height === 0 && dbh > 0) {
            const biomass1 = estimate *dbh;
            const biomass2 = estimate *dbh * 5;
            option.text = `${row.speciesx}`;
            option.setAttribute("data-biomass1", biomass1);
            option.setAttribute("data-biomass2", biomass2);
            
          } if (height > 0 && dbh > 0)        
           {
            const biomass1 = estimate * dbh * height;
            const biomass2 = estimate * dbh * height * 5;
            option.text = `${row.speciesx}`;
            option.setAttribute("data-biomass1", biomass1);
            option.setAttribute("data-biomass2", biomass2);
          }

          dropdown.appendChild(option);
        });

        dropdown.addEventListener("change", function () {
          const selected = this.selectedOptions[0];
          const biomass1 = parseFloat(selected.getAttribute("data-biomass1"));
          const biomass2 = parseFloat(selected.getAttribute("data-biomass2"));

          const resultText = `Biomass 1 (DBH × 5): ${biomass1} kg\n` +
                             `Biomass 2 (DBH × Height): ${biomass2} kg`;

          document.getElementById("result").innerText = resultText;
        });

        dropdown.dispatchEvent(new Event("change"));
      });
    }
  </script>
</body>
</html>