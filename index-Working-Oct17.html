<!DOCTYPE html>
<html>
<head>
  <title>Tree Data Processor</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <h2>Enter Height and DBH</h2>

  <label for="heightInput">Height:</label>
  <input type="number" id="heightInput" step="0.01" value="0" />

  <label for="dbhInput">DBH:</label>
  <input type="number" id="dbhInput" step="0.01" value="0" />

  <button onclick="loadCSV()">Load Data</button>

  <br><br>
  <select id="dropdown"></select>
  <p id="result"></p>

  <script>
    function loadCSV() {
      const height = parseFloat(document.getElementById("heightInput").value) || 0;
      const dbh = parseFloat(document.getElementById("dbhInput").value) || 0;

     const aCsvUrl = "https://raw.githubusercontent.com/hamidzar/hamidzar.github.io/main/biomass/AGBnoHeight.csv"; // Replace with your actual CSV URL
     const bCsvUrl = "https://raw.githubusercontent.com/hamidzar/hamidzar.github.io/main/biomass/AGBwithheights.csv";
      const csvUrl = height === 0 ? aCsvUrl : bCsvUrl;

      d3.csv(csvUrl).then(data => {
        const dropdown = document.getElementById("dropdown");
        dropdown.innerHTML = "";

        data.forEach(row => {
        
           const option = document.createElement("option"); 
           if (height === 0 && dbh > 0) {
            const estimate1 = parseFloat(row.estimatebwood1);
            const estimate2 = parseFloat(row.estimatebwood2);
            const estimate3 = parseFloat(row.estimatebbark1);
            const estimate4 = parseFloat(row.estimatebbark2);
            const estimate5 = parseFloat(row.estimatebbranches1);
            const estimate6 = parseFloat(row.estimatebbranches2);
            const estimate7 = parseFloat(row.estimatebfoliage1);
            const estimate8 = parseFloat(row.estimatebfoliage2);
            

            const ywood = estimate1 * (dbh ** estimate2); 
            const ybark = estimate3 * (dbh ** estimate2);
            const ystem = ywood + ybark;
            const ybranches = estimate5 * (dbh ** estimate6);
            const yfoliage = estimate7 * (dbh ** estimate8);
            const ycrown1 = yfoliage + ybranches;
            const ycrown2 = ywood + ybark + yfoliage + ybranches;
            const ytotal = ywood + ybark + ybranches + yfoliage;

            option.text = `${row.speciesx}`;
            option.setAttribute("DBH", dbh);
            option.setAttribute("Height", height);
            option.setAttribute("ywood", ywood);
            option.setAttribute("ybark", ybark);
            option.setAttribute("ystem", ystem);
            option.setAttribute("ybranches", ybranches);
            option.setAttribute("yfoliage", yfoliage);
            option.setAttribute("ycrown1", ycrown1);
            option.setAttribute("ycrown2", ycrown2);
            option.setAttribute("ytotal", ytotal);

          } if (height > 0 && dbh > 0)        
           {
            const estimate1 = parseFloat(row.estimatebwood1);
            const estimate2 = parseFloat(row.estimatebwood2);
            const estimate3 = parseFloat(row.estimatebwood3);
            const estimate4 = parseFloat(row.estimatebbark1);
            const estimate5 = parseFloat(row.estimatebbark2);
            const estimate6 = parseFloat(row.estimatebbark3);
            const estimate7 = parseFloat(row.estimatebbranches1);
            const estimate8 = parseFloat(row.estimatebbranches2);
            const estimate9 = parseFloat(row.estimatebbranches3);
            const estimate10 = parseFloat(row.estimatebfoliage1);
            const estimate11 = parseFloat(row.estimatebfoliage2);
            const estimate12 = parseFloat(row.estimatebfoliage3);

            const ywood = estimate1 * (dbh ** estimate2) * (height ** estimate3) *  estimate3;
            const ybark = estimate4 * (dbh ** estimate5) * (height ** estimate6) * estimate6;
            const ystem = ywood + ybark;
            const ybranches = estimate7 * (dbh ** estimate8) * (height ** estimate9);
            const yfoliage = estimate10 * (dbh ** estimate11) * (height ** estimate12);
            const ycrown1 = yfoliage + ybranches;
            const ycrown2 = 0; 
            const ytotal = ywood + ybark + ybranches + yfoliage;

          
            option.text = `${row.speciesx}`;
            option.setAttribute("DBH", dbh);
            option.setAttribute("Height", height);
            option.setAttribute("ywood", ywood);
            option.setAttribute("ybark", ybark);
            option.setAttribute("ystem", ystem);
            option.setAttribute("ybranches", ybranches);
            option.setAttribute("yfoliage", yfoliage);
            option.setAttribute("ycrown1", ycrown1);
            option.setAttribute("ycrown2", ycrown2);
            option.setAttribute("ytotal", ytotal);
          }

          dropdown.appendChild(option);
        });

        dropdown.addEventListener("change", function () {
          
          const selected = this.selectedOptions[0];

          const Height = parseFloat(selected.getAttribute("height"));
          const DBH = parseFloat(selected.getAttribute("dbh"));
          const ywood = parseFloat(selected.getAttribute("ywood"));
          const ybark = parseFloat(selected.getAttribute("ybark"));
          const ystem = parseFloat(selected.getAttribute("ystem"));
          const ybranches = parseFloat(selected.getAttribute("ybranches"));
          const yfoliage = parseFloat(selected.getAttribute("yfoliage"));
          const ycrown1 = parseFloat(selected.getAttribute("ycrown1"));
          const ycrown2 = parseFloat(selected.getAttribute("ycrown2"));
          const ytotal = parseFloat(selected.getAttribute("ytotal"));
          
          const resultText = `Height : ${height} \n` +
                              `DBH : ${dbh} \n` +
                              `ywood : ${ywood.toFixed(6)} \n` +
                              `ybark : ${ybark.toFixed(6)} \n` +
                              `ystem : ${ystem.toFixed(6)} \n` +
                              `ybranches : ${ybranches.toFixed(6)} \n` +
                              `yfoliage : ${yfoliage.toFixed(6)} \n` +
                              `ycrown1 : ${ycrown1.toFixed(6)} \n` +
                              `ycrown2 : ${ycrown2.toFixed(6)} \n` +
                              `ytotal : ${ytotal.toFixed(6)} \n` ;
                              

          const resultElement = document.getElementById("result");
          resultElement.innerText = resultText;
          resultElement.style.color = "black";
        });

        dropdown.dispatchEvent(new Event("change"));
      });
    }
  </script>
</body>
</html>